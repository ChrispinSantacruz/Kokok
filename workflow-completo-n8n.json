{
  "name": "KOKOK Game - Flujo Completo",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"]
      },
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "telegram-bot-trigger",
      "credentials": {
        "telegramApi": {
          "id": "tu-telegram-credentials-id",
          "name": "Tu Bot Telegram"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json[\"message\"][\"text\"]}}",
              "operation": "equal",
              "value2": "/start"
            }
          ]
        }
      },
      "name": "Es comando Start?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json[\"message\"][\"chat\"][\"id\"]}}",
        "text": "ğŸª³ Â¡Bienvenido a KOKOK THE ROACH! ğŸª³\n\nğŸ® El juego donde eres una cucaracha que dispara fajos de billetes para derrotar a jefes como Trump y Elon.\n\nâœ¨ CaracterÃ­sticas:\nâ€¢ Jefes Ãºnicos con ataques especiales\nâ€¢ Power-ups de escudo y velocidad\nâ€¢ Sistema de puntuaciÃ³n y rÃ©cords\nâ€¢ Controles fÃ¡ciles para mÃ³vil y PC\n\nğŸ¯ Â¡Haz clic en el botÃ³n para empezar a jugar!",
        "replyMarkup": {
          "inlineKeyboard": [
            [
              {
                "text": "ğŸ® JUGAR KOKOK THE ROACH",
                "web_app": {
                  "url": "https://tu-dominio.vercel.app?chat_id={{$json[\"message\"][\"chat\"][\"id\"]}}"
                }
              }
            ],
            [
              {
                "text": "ğŸ“– Instrucciones",
                "callback_data": "help"
              },
              {
                "text": "ğŸ† Mi RÃ©cord",
                "callback_data": "record"
              }
            ]
          ]
        },
        "options": {}
      },
      "name": "Enviar Mensaje de Bienvenida",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [680, 200],
      "credentials": {
        "telegramApi": {
          "id": "tu-telegram-credentials-id",
          "name": "Tu Bot Telegram"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "1017d610-1159-4eed-b4e7-8644b0f3ace9",
        "options": {}
      },
      "name": "Webhook Game Over",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 600],
      "webhookId": "1017d610-1159-4eed-b4e7-8644b0f3ace9"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json[\"event\"]}}",
              "operation": "equal",
              "value2": "game_over"
            }
          ]
        }
      },
      "name": "Es Game Over?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 600]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json[\"chatId\"]}}",
        "text": "ğŸ® Â¡Partida terminada! ğŸ®\n\nğŸ‘¤ Jugador: {{$json[\"playerName\"]}}\nğŸ¯ PuntuaciÃ³n: {{$json[\"score\"]}} puntos\nâ±ï¸ Tiempo: {{$json[\"gameTime\"]}}\nğŸ“± Plataforma: {{$json[\"additionalData\"][\"platform\"]}}\n\n{{$json[\"additionalData\"][\"isNewRecord\"] ? \"ğŸ† Â¡FELICIDADES! Â¡Nuevo rÃ©cord personal!\" : \"ğŸ“Š RÃ©cord anterior: \" + $json[\"additionalData\"][\"previousHighScore\"] + \" puntos\"}}\n\n{{$json[\"userInfo\"][\"isFirstTime\"] ? \"ğŸ‘‹ Â¡Bienvenido! Esta fue tu primera partida.\" : \"ğŸ® Â¡Gracias por jugar de nuevo!\"}}\n\nğŸ’ª Â¿Puedes superarlo? Â¡Intenta de nuevo!",
        "replyMarkup": {
          "inlineKeyboard": [
            [
              {
                "text": "ğŸ® JUGAR DE NUEVO",
                "web_app": {
                  "url": "https://tu-dominio.vercel.app?chat_id={{$json[\"chatId\"]}}"
                }
              }
            ],
            [
              {
                "text": "ğŸ“Š Ver EstadÃ­sticas",
                "callback_data": "stats_{{$json[\"chatId\"]}}"
              },
              {
                "text": "ğŸ† Ranking",
                "callback_data": "ranking"
              }
            ]
          ]
        },
        "options": {}
      },
      "name": "Enviar PuntuaciÃ³n AutomÃ¡tica",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [680, 500],
      "credentials": {
        "telegramApi": {
          "id": "tu-telegram-credentials-id",
          "name": "Tu Bot Telegram"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{$json[\"score\"]}}",
              "operation": "larger",
              "value2": 200
            }
          ]
        }
      },
      "name": "PuntuaciÃ³n Alta?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 700]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json[\"chatId\"]}}",
        "text": "ğŸŒŸ Â¡PUNTUACIÃ“N EXCEPCIONAL! ğŸŒŸ\n\nğŸ† {{$json[\"playerName\"]}} ha logrado {{$json[\"score\"]}} puntos!\n\nğŸ’ Â¡Eres un verdadero maestro de KOKOK!\nğŸ‰ Â¡Compartamos este logro con todos!\n\n#KokokTheRoach #HighScore #Gaming",
        "options": {}
      },
      "name": "Mensaje PuntuaciÃ³n Alta",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [900, 620],
      "credentials": {
        "telegramApi": {
          "id": "tu-telegram-credentials-id",
          "name": "Tu Bot Telegram"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json[\"additionalData\"][\"isNewRecord\"]}}",
              "value2": true
            }
          ]
        }
      },
      "name": "Es Nuevo RÃ©cord?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 900]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json[\"chatId\"]}}",
        "text": "ğŸ† Â¡NUEVO RÃ‰CORD ESTABLECIDO! ğŸ†\n\nğŸ¯ {{$json[\"playerName\"]}} rompiÃ³ su rÃ©cord anterior!\nğŸ“ˆ PuntuaciÃ³n anterior: {{$json[\"additionalData\"][\"previousHighScore\"]}}\nğŸš€ Nueva puntuaciÃ³n: {{$json[\"score\"]}}\n\nğŸŠ Â¡Felicitaciones por tu mejora!\nğŸ’ª Â¡Sigue asÃ­ y alcanza las estrellas!\n\n#NewRecord #KokokTheRoach",
        "options": {}
      },
      "name": "Mensaje Nuevo RÃ©cord",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [900, 820],
      "credentials": {
        "telegramApi": {
          "id": "tu-telegram-credentials-id",
          "name": "Tu Bot Telegram"
        }
      }
    },
    {
      "parameters": {
        "resource": "sheet",
        "operation": "append",
        "sheetId": "tu-google-sheet-id",
        "range": "A:H",
        "values": [
          [
            "={{$json[\"timestamp\"]}}",
            "={{$json[\"playerName\"]}}",
            "={{$json[\"score\"]}}",
            "={{$json[\"gameTime\"]}}",
            "={{$json[\"chatId\"]}}",
            "={{$json[\"additionalData\"][\"isNewRecord\"]}}",
            "={{$json[\"userInfo\"][\"isFirstTime\"]}}",
            "={{$json[\"additionalData\"][\"platform\"]}}"
          ]
        ],
        "options": {}
      },
      "name": "Guardar en Google Sheets",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 1,
      "position": [460, 800],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "tu-google-sheets-credentials-id",
          "name": "Google Sheets API"
        }
      }
    },
    {
      "parameters": {
        "functionCode": "// Generar estadÃ­sticas del jugador\nconst data = items[0].json;\n\n// Simular carga de estadÃ­sticas previas (esto podrÃ­as mejorarlo con una base de datos)\nconst stats = {\n  totalGames: 1, // Incrementar segÃºn lÃ³gica\n  totalScore: data.score,\n  averageScore: data.score,\n  bestScore: data.additionalData.isNewRecord ? data.score : data.additionalData.previousHighScore,\n  totalTime: data.gameTime,\n  platform: data.additionalData.platform,\n  firstGameDate: data.userInfo.isFirstTime ? data.timestamp : null\n};\n\nreturn {\n  json: {\n    ...data,\n    playerStats: stats\n  }\n};"
      },
      "name": "Procesar EstadÃ­sticas",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [460, 1000]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{$json[\"userInfo\"][\"isFirstTime\"]}}",
              "value2": true
            }
          ]
        }
      },
      "name": "Es Primer Juego?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [680, 1100]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json[\"chatId\"]}}",
        "text": "ğŸ‰ Â¡BIENVENIDO A KOKOK! ğŸ‰\n\nğŸ‘‹ {{$json[\"playerName\"]}}, esta fue tu primera partida\nğŸ¯ Primera puntuaciÃ³n: {{$json[\"score\"]}} puntos\nâ±ï¸ Tiempo: {{$json[\"gameTime\"]}}\n\nğŸ’¡ Consejos para mejorar:\nâ€¢ Recoge los power-ups de escudo ğŸ›¡ï¸\nâ€¢ Usa la velocidad extra âš¡\nâ€¢ Esquiva las bombas de Trump ğŸ’£\nâ€¢ Evita los cohetes de Elon ğŸš€\n\nğŸš€ Â¡La prÃ³xima vez puedes hacerlo mejor!\n\n#Welcome #FirstGame #KokokTheRoach",
        "options": {}
      },
      "name": "Mensaje Primer Juego",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [900, 1020],
      "credentials": {
        "telegramApi": {
          "id": "tu-telegram-credentials-id",
          "name": "Tu Bot Telegram"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Es comando Start?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Es comando Start?": {
      "main": [
        [
          {
            "node": "Enviar Mensaje de Bienvenida",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Game Over": {
      "main": [
        [
          {
            "node": "Es Game Over?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Es Game Over?": {
      "main": [
        [
          {
            "node": "Enviar PuntuaciÃ³n AutomÃ¡tica",
            "type": "main",
            "index": 0
          },
          {
            "node": "PuntuaciÃ³n Alta?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Es Nuevo RÃ©cord?",
            "type": "main",
            "index": 0
          },
          {
            "node": "Guardar en Google Sheets",
            "type": "main",
            "index": 0
          },
          {
            "node": "Procesar EstadÃ­sticas",
            "type": "main",
            "index": 0
          },
          {
            "node": "Es Primer Juego?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PuntuaciÃ³n Alta?": {
      "main": [
        [
          {
            "node": "Mensaje PuntuaciÃ³n Alta",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Es Nuevo RÃ©cord?": {
      "main": [
        [
          {
            "node": "Mensaje Nuevo RÃ©cord",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesar EstadÃ­sticas": {
      "main": [
        [
          {
            "node": "Es Primer Juego?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Es Primer Juego?": {
      "main": [
        [
          {
            "node": "Mensaje Primer Juego",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "timezone": "America/Mexico_City"
  },
  "staticData": null
} 