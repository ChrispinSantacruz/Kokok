{
  "name": "KOKOK Game - Sistema Manual FINAL",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"]
      },
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [240, 300],
      "webhookId": "telegram-bot-trigger",
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-8133621887",
          "name": "KOKOK Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.message.text }}",
              "operation": "regex",
              "value2": "^\\/start(@koko_roach_bot)?$"
            }
          ]
        }
      },
      "name": "Es comando Start?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendPhoto",
        "chatId": "={{ $json.message.chat.id }}",
        "photo": "https://i.imgur.com/KOKOKImage.jpg",
        "additionalFields": {
          "caption": "ðŸª³ Â¡Bienvenido a KOKOK THE ROACH! ðŸª³\n\nðŸŽ® Eres una cucaracha que dispara fajos de billetes para derrotar a jefes como Trump y Elon.\n\nâœ¨ CaracterÃ­sticas del juego:\nâ€¢ Login personalizado con tu nombre\nâ€¢ Jefes Ãºnicos: Trump (bombas) y Elon (cohetes)\nâ€¢ Power-ups especiales de escudo y azÃºcar\nâ€¢ Compartir tu puntuaciÃ³n cuando quieras\nâ€¢ Controles optimizados para mÃ³vil y PC\n\nðŸŽ¯ Â¡Haz clic para empezar!",
          "replyMarkup": {
            "inline_keyboard": [
              [
                {
                  "text": "ðŸŽ® JUGAR KOKOK THE ROACH",
                  "web_app": {
                    "url": "https://kokokthegame.vercel.app?chat_id={{ $json.message.chat.id }}"
                  }
                }
              ]
            ]
          }
        }
      },
      "name": "Enviar Mensaje de Bienvenida con Imagen",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [680, 300],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-8133621887",
          "name": "KOKOK Bot"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "1017d610-1159-4eed-b4e7-8644b0f3ace9",
        "options": {}
      },
      "name": "Webhook Compartir Manual",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [240, 600],
      "webhookId": "1017d610-1159-4eed-b4e7-8644b0f3ace9"
    },
    {
      "parameters": {
        "functionCode": "// Log de debug para ver la estructura completa de datos\nconsole.log('ðŸ” Estructura completa de datos:', JSON.stringify(items, null, 2));\nconsole.log('ðŸ” Primer item:', JSON.stringify(items[0], null, 2));\n\n// Acceder a los datos correctamente desde el webhook\nlet data;\nif (items[0].json.body) {\n  // Datos vienen en body (tÃ­pico de webhooks)\n  data = items[0].json.body;\n  console.log('ðŸ“¦ Datos desde body:', JSON.stringify(data, null, 2));\n} else {\n  // Datos vienen directamente\n  data = items[0].json;\n  console.log('ðŸ“¦ Datos directos:', JSON.stringify(data, null, 2));\n}\n\n// Validar que tengamos los datos necesarios\nif (!data.playerName || data.score === undefined || !data.chatId) {\n  console.error('âŒ Faltan datos importantes:', {\n    playerName: !!data.playerName,\n    score: data.score !== undefined,\n    chatId: !!data.chatId,\n    datosRecibidos: data\n  });\n  return [{\n    json: {\n      error: 'Datos incompletos',\n      receivedData: data,\n      fullStructure: items[0]\n    }\n  }];\n}\n\n// Crear mensaje personalizado para Telegram\nlet message = `ðŸŽ® Â¡${data.playerName} ha logrado ${data.score} puntos en KOKOK THE ROACH! ðŸª³\\n\\n`;\n\n// Agregar emoji y mensaje segÃºn la puntuaciÃ³n\nif (data.score >= 1000) {\n  message += `ðŸ† Â¡LEYENDA CUCARACHA! Â¡PuntuaciÃ³n Ã©pica! ðŸ†\\n`;\n} else if (data.score >= 500) {\n  message += `ðŸ”¥ Â¡INCREÃBLE PUNTUACIÃ“N! Â¡Eres un maestro cucaracha! ðŸ”¥\\n`;\n} else if (data.score >= 300) {\n  message += `â­ Â¡EXCELENTE! Â¡Dominas el arte del combate! â­\\n`;\n} else if (data.score >= 200) {\n  message += `ðŸ’ª Â¡MUY BUENO! Â¡Sigue mejorando! ðŸ’ª\\n`;\n} else if (data.score >= 100) {\n  message += `ðŸ‘ Â¡BUEN TRABAJO! Â¿Puedes llegar a 200? ðŸ‘\\n`;\n} else if (data.score >= 50) {\n  message += `ðŸš€ Â¡BUEN INICIO! Â¡La prÃ¡ctica hace al maestro! ðŸš€\\n`;\n} else {\n  message += `ðŸ’« Â¡SIGUE INTENTANDO! Â¡Cada cucaracha empieza desde abajo! ðŸ’«\\n`;\n}\n\nmessage += `\\nðŸ’ª Â¿Puedes superarlo? Â¡Juega ahora y conviÃ©rtete en la cucaracha mÃ¡s poderosa!\\n\\n#KokokTheRoach #CryptoGame #${data.playerName.replace(/[^a-zA-Z0-9]/g, '')}`;\n\n// Generar estadÃ­sticas de rendimiento\nlet performanceLevel = 'Novato';\nif (data.score >= 1000) performanceLevel = 'Leyenda';\nelse if (data.score >= 500) performanceLevel = 'Experto';\nelse if (data.score >= 300) performanceLevel = 'Avanzado';\nelse if (data.score >= 100) performanceLevel = 'Intermedio';\n\nconsole.log('âœ… Mensaje generado:', message);\n\n// Devolver datos procesados\nreturn [{\n  json: {\n    chatId: data.chatId,\n    playerName: data.playerName,\n    score: data.score,\n    message: message,\n    isManualShare: data.additionalData?.isManualShare || true,\n    platform: data.additionalData?.platform || 'unknown',\n    performanceLevel: performanceLevel,\n    timestamp: data.timestamp,\n    gameSession: data.gameSession\n  }\n}];"
      },
      "name": "Procesar Datos del Juego",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [460, 600]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendPhoto",
        "chatId": "={{ $json.chatId }}",
        "photo": "https://i.imgur.com/KOKOKScore.jpg",
        "additionalFields": {
          "caption": "={{ $json.message }}",
          "replyMarkup": {
            "inline_keyboard": [
              [
                {
                  "text": "ðŸŽ® JUGAR DE NUEVO",
                  "web_app": {
                    "url": "https://kokokthegame.vercel.app?chat_id={{ $json.chatId }}"
                  }
                }
              ]
            ]
          }
        }
      },
      "name": "Enviar PuntuaciÃ³n con Imagen",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [680, 600],
      "credentials": {
        "telegramApi": {
          "id": "telegram-bot-8133621887",
          "name": "KOKOK Bot"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Es comando Start?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Es comando Start?": {
      "main": [
        [
          {
            "node": "Enviar Mensaje de Bienvenida con Imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook Compartir Manual": {
      "main": [
        [
          {
            "node": "Procesar Datos del Juego",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Procesar Datos del Juego": {
      "main": [
        [
          {
            "node": "Enviar PuntuaciÃ³n con Imagen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "timezone": "America/Mexico_City"
  },
  "staticData": null
} 